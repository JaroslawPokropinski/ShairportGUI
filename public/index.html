<!DOCTYPE html>
<html>
    <head>
        <title>ShairportGUI</title>
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Khula:wght@400;600;700&family=Public+Sans:wght@100;300;400;600&display=swap");

            :root {
                --brShadow: -3px 3px 15px #ffffff;
                --tlShadow: 3px -3px 15px #ffffff;
                --songColor: #ffffff;
                --artistColor: #ffffff;
                --borderColor: #ffffff;
            }

            body {
                background-color: #000000;
                font-family: "Public Sans", sans-serif;
                color: var(--songColor);
                overflow: hidden;
            }

            .container {
                position: absolute;
                z-index: 1000;
                height: 100vh;
                width: 100%;
                display: flex;
                flex-direction: row;
                align-items: center;
                justify-content: center;
            }

            .background-img {
                position: fixed;
                top: 0;
                left: 0;
                z-index: 1;
                display: block;
                background-image: url(http://test.palitechnika.com/rosa.png);
                background-repeat: no-repeat;
                background-position: center;
                background-size: cover;
                width: 100%;
                height: 100%;
                filter: blur(30px);
            }

            #phone {
                display: flex;
                flex-direction: row;
                align-items: center;
                justify-content: center;
                /* gap: 10%; commented coz doesn't work on chromium pi*/
                background-color: rgba(255, 255, 255, 0.5);
                /* background: linear-gradient(
                    0deg,
                    rgba(255, 255, 255, 0.0) 0%,
                    rgba(255, 255, 255, 0.5) 50%,
                    rgba(255, 255, 255, 0.0) 100%
                ); */
                background: none;
                height: 90vh;
                width: 90%;
                padding: 2-px;
                border-radius: 25px;
                /* box-shadow: rgba(223, 230, 255, 0.1) 0px 48px 100px 0px, */
                /* rgba(43, 42, 46, 0.15) 0px 30px 100px 0px; */
            }

            .song-thumbnail {
                height: 600px;
                width: 600px;
                border-radius: 50%;
            }

            .thumbnail-border {
                display: flex;
                height: 600px;
                width: 600px;
                border-radius: 50%;
                padding: 0.4rem;
                background-color: var(--borderColor);
                box-shadow: inset 6px 6px 20px 0 rgba(255, 255, 255, 0.2),
                    rgba(255, 255, 255, 0.1) 0px 4px 20px,
                    rgba(255, 255, 255, 0.1) 0px 8px 24px,
                    rgba(126, 126, 126, 0.4) 0px 16px 45px;
                /* animation: spin 40s linear infinite; */
            }

            #song-details {
                /* margin-top: 5%; */
                display: flex;
                flex-direction: column;
                width: 30%;
                /* align-items: center; */
                text-overflow: ellipsis;
                overflow: hidden;
                white-space: normal;
                padding-left: 10%;
                text-shadow: var(--brShadow), var(--tlShadow);
                overflow: visible;
            }

            .song-title {
                font-size: 4rem;
                font-weight: bolder;
            }

            .album-title {
                font-size: 2rem;
                color: var(--borderColor);
            }

            .artist {
                font-size: 2rem;
                color: var(--artistColor);
            }

            @keyframes spin {
                100% {
                    -webkit-transform: rotate(360deg);
                    transform: rotate(360deg);
                }
            }
        </style>
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
            integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />
    </head>
    <body>
        <div class="background-img"></div>
        <div class="container">
            <div id="phone">
                <div class="thumbnail-border">
                    <img
                        id="cover"
                        src="http://test.palitechnika.com/rosa.png"
                        class="song-thumbnail"
                    />
                </div>
                <!--/thumbnail-border -->

                <div id="song-details">
                    <h1 id="title" class="song-title">Song Title</h1>
                    <h1 id="album" class="album-title">Album title</h1>
                    <span id="artist" class="artist">Band ft. Song Artist</span>
                </div>
                <!-- /song-details -->
            </div>
            <!-- /phone -->
        </div>
        <!-- /container -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
        <script>
            let r = document.querySelector(":root");
            const applyPallette = (palette) => {
                r.style.setProperty("--songColor", palette.songColor);
                r.style.setProperty("--artistColor", palette.artistColor);
                r.style.setProperty("--borderColor", palette.borderColor);
                r.style.setProperty("--brShadow", "-3px 3px 15px" + palette.brShadow);
                r.style.setProperty("--tlShadow", "3px -3px 15px" + palette.tlShadow);
            };

            var socket = io();
            socket.on("metadata", function (metadata) {
                let title = document.getElementById("title");
                let album = document.getElementById("album");
                let artist = document.getElementById("artist");
                title.textContent = metadata.title;
                album.textContent = metadata.album;
                artist.textContent = metadata.artist;
                console.log("data get!");
            });

            socket.on("pictureData", function (pictureData) {
                console.log("picture get!");
                let img = document.getElementById("cover");
                let bgImg =
                    document.getElementsByClassName("background-img")[0];
                img.src = `data:image/png;base64,` + pictureData;
                console.log("cover picture set!");
                bgImg.style.backgroundImage = `url(data:image/png;base64,${pictureData})`;
                console.log("background picture set!");
            });

            socket.on("palette", function (palette) {
                console.log("palette get!");
                applyPallette(palette);
                console.log("palette set!");
            });
        </script>
    </body>
</html>
